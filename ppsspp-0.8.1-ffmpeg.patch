diff -urN ppsspp-0.8.1-orig/CMakeLists.txt ppsspp-0.8.1-patched/CMakeLists.txt
--- ppsspp-0.8.1-orig/CMakeLists.txt	2013-06-27 06:54:44.000000000 +1100
+++ ppsspp-0.8.1-patched/CMakeLists.txt	2013-06-27 17:51:39.649237025 +1100
@@ -1074,6 +1074,18 @@
 	setup_target_project(PPSSPPHeadless headless)
 endif()
 
+if(USE_FFMPEG)
+	SET (FFMPEG_LIBRARIES
+		avformat
+		avcodec
+		avutil
+		swresample
+		swscale
+	)
+	set(nativeExtraLibs ${nativeExtraLibs} ${FFMPEG_LIBRARIES})
+	add_definitions(-DUSE_FFMPEG)
+endif(USE_FFMPEG)
+
 set(NativeAppSource
 	UI/NativeApp.cpp
 	UI/EmuScreen.cpp
@@ -1095,61 +1107,6 @@
 	assets/ppge_atlas.zim)
 set(LinkCommon ${CoreLibName} ${CMAKE_THREAD_LIBS_INIT} ${nativeExtraLibs})
 
-if(USE_FFMPEG AND NOT DEFINED FFMPEG_BUILDDIR)
-	if(BLACKBERRY)
-		set(PLATFORM_ARCH "blackberry/armv7")
-	elseif(IOS)
-		set(PLATFORM_ARCH "ios/universal")
-	elseif(MACOSX)
-		set(PLATFORM_ARCH "macosx/x86_64")
-	endif()
-	# Using static libraries
-	if (DEFINED PLATFORM_ARCH)
-		include_directories(ffmpeg/${PLATFORM_ARCH}/include)
-		link_directories(ffmpeg/${PLATFORM_ARCH}/lib)
-		set(FFMPEG_LIBRARIES libavformat.a libavcodec.a libavutil.a libswresample.a libswscale.a)
-	else()
-		message(WARNING "FFMPEG_BUILDDIR variable is required to enable FFmpeg. Disabling it.")
-		unset(USE_FFMPEG)
-	endif()
-endif(USE_FFMPEG AND NOT DEFINED FFMPEG_BUILDDIR)
-
-if(USE_FFMPEG)
-	# Using shared libraries
-	if(DEFINED FFMPEG_BUILDDIR)
-		include_directories(ffmpeg ${FFMPEG_BUILDDIR})
-
-		add_library(libavformat STATIC IMPORTED)
-		set_target_properties(libavformat PROPERTIES IMPORTED_LOCATION ${FFMPEG_BUILDDIR}/libavformat/libavformat.a)
-		add_library(libavcodec STATIC IMPORTED)
-		set_target_properties(libavcodec PROPERTIES IMPORTED_LOCATION ${FFMPEG_BUILDDIR}/libavcodec/libavcodec.a)
-		add_library(libavutil STATIC IMPORTED)
-		set_target_properties(libavutil PROPERTIES IMPORTED_LOCATION ${FFMPEG_BUILDDIR}/libavutil/libavutil.a)
-		add_library(libswresample STATIC IMPORTED)
-		set_target_properties(libswresample PROPERTIES IMPORTED_LOCATION ${FFMPEG_BUILDDIR}/libswresample/libswresample.a)
-		add_library(libswscale STATIC IMPORTED)
-		set_target_properties(libswscale PROPERTIES IMPORTED_LOCATION ${FFMPEG_BUILDDIR}/libswscale/libswscale.a)
-
-		SET (FFMPEG_LIBRARIES
-			libavformat
-			libavcodec
-			libavutil
-			libswresample
-			libswscale
-		)
-	endif()
-	if(IOS OR BLACKBERRY)
-		set(FFMPEG_LIBRARIES ${FFMPEG_LIBRARIES} iconv)
-	endif()
-
-	if(APPLE)
-		set(FFMPEG_LIBRARIES ${FFMPEG_LIBRARIES} bz2 "-framework VideoDecodeAcceleration" "-framework CoreVideo")
-	endif(APPLE)
-	
-	set(LinkCommon ${LinkCommon} ${FFMPEG_LIBRARIES})
-	add_definitions(-DUSE_FFMPEG)
-endif(USE_FFMPEG)
-
 if (TargetBin)
 	if (IOS)
 		add_executable(${TargetBin} MACOSX_BUNDLE ${NativeAppSource})
diff -urN ppsspp-0.8.1-orig/Core/HW/MediaEngine.h ppsspp-0.8.1-patched/Core/HW/MediaEngine.h
--- ppsspp-0.8.1-orig/Core/HW/MediaEngine.h	2013-06-27 06:54:44.000000000 +1100
+++ ppsspp-0.8.1-patched/Core/HW/MediaEngine.h	2013-06-27 17:31:36.115233778 +1100
@@ -30,9 +30,20 @@
 #include "ChunkFile.h"
 #include "Core/HW/MpegDemux.h"
 
+extern "C" {
+#include <libavformat/avformat.h>
+}
+#ifndef AVPixelFormat
+#define AVPixelFormat PixelFormat
+#define AV_PIX_FMT_BGR565LE PIX_FMT_BGR565LE
+#define AV_PIX_FMT_BGR555LE PIX_FMT_BGR555LE
+#define AV_PIX_FMT_BGR444LE PIX_FMT_BGR444LE
+#define AV_PIX_FMT_RGBA PIX_FMT_RGBA
+#endif
+
 struct SwsContext;
 struct AVFrame;
-struct AVIOContext;
+//struct AVIOContext;
 struct AVFormatContext;
 struct AVCodecContext;
 
